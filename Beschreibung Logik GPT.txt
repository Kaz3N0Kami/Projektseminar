â­ EINFACHE BESCHREIBUNG DES ALGORITHMUS

Der Code simuliert jede einzelne Stunde zwischen Anfang 2023 und Ende 2024 und berechnet dabei:

wie viel Strom das Haus benÃ¶tigt

wie viel davon aus dem Netz kommt

wie der Speicher geladen oder entladen wird

wie viel der Strom kostet (bei verschiedenen Tarifmodellen)

Der Algorithmus entscheidet also in jeder Stunde:

1. Welcher Tarif gilt?

Konstanter Preis â†’ einfache Berechnung

Dynamischer Preis â†’ Preis Ã¤ndert sich jede Stunde

Mit oder ohne Speicher

Mit Speziallogik (DynPlus)

2. Soll der Speicher geladen werden?

Der Algorithmus schaut 24 Stunden in die Zukunft (Lookahead):

Gibt es bald gÃ¼nstigere Stunden?

Wenn JA, wartet er mit dem Laden.

Wenn NEIN, und die aktuelle Stunde ist gÃ¼nstig â†’ Speicher wird vollgeladen.

ABER:

Wenn ein Preisaufschlag aktiv ist â†’ nicht laden.

3. Wie wird der Hausverbrauch gedeckt?

FÃ¼r jede Stunde:

Wenn der Speicher genug Energie hat:

â†’ Haus verbraucht nur Speicher â†’ kein Netzverbrauch

Wenn der Speicher leer oder fast leer ist:

â†’ restliche Energie wird aus dem Stromnetz gezogen

4. Kosten werden berechnet

Je nach Tarif:

Konstantpreis

einfache Formel: Preis * Verbrauch

Dynamischer Tarif

aktueller Stundenpreis * Netzverbrauch

wenn Preis negativ ist â†’ Kunde verdient Geld

DynPlus Tarif

sehr komplex:

prÃ¼ft zusÃ¤tzliche AufschlÃ¤ge

berechnet Verluste/Gewinne

verschiebt bestimmte Abgaben

bestimmt einen â€optimalen Preisâ€œ

Der Code sammelt dabei viele Statistiken:

Wie oft Speicher leer war

Wie viel Verlust der Staat hÃ¤tte

Wie viel der Kunde spart oder verdient

Wie viel Netzverbrauch durch AufschlÃ¤ge entsteht

5. Log speichern

Wenn Logging eingeschaltet ist:

Jede Stunde wird in einer Logdatei gespeichert, inkl.:

Datum

Preise

Netzverbrauch

Speicherstand

DynPlusPreis

Verlust usw.

6. Zwischenergebnisse aktualisieren

Der Code aktualisiert regelmÃ¤ÃŸig (oder am Ende):

Gesamtkosten

Einsparungen

SpeicherstÃ¤nde

Verluste / Gewinne

Damit kÃ¶nnen andere Programmteile die Simulation anzeigen.

â­ Kurzfassung in 3 SÃ¤tzen

Der Algorithmus simuliert jede Stunde, wie viel Strom das Haus braucht, ob der Speicher geladen/entladen wird und ob Strom aus dem Netz kommt. Dabei berÃ¼cksichtigt er dynamische Strompreise, mÃ¶gliche gÃ¼nstigere Stunden in der Zukunft und verschiedene Tarifmodelle. Am Ende berechnet er die gesamten Kosten, Einsparungen und Statistiken.

=================================================================================================

â­ ALG 10 â€“ Fester Preis, kein Speicher-Tricksen

Kurz gesagt:
Der Strompreis bleibt immer gleich. Es gibt keinen Grund, auf billige Stunden zu warten.

Der Algorithmus macht daher nur:

Jede Stunde berechnen â†’ Verbrauch * Preis

Nichts optimieren, nichts verschieben

Kein Lookahead, kein Speicher-Management

â†’ Einfachster Modus.

â­ ALG 100 â€“ Dynamischer Preis ohne Speicher-Intelligenz

Kurz gesagt:
Die Preise Ã¤ndern sich stÃ¼ndlich, aber der Speicher wird noch nicht taktisch genutzt.

Der Algorithmus macht:

Jede Stunde nehmen, wie sie ist

Wenn teuer â†’ Pech

Wenn billig â†’ GlÃ¼ck

Speicher wird nicht absichtlich geladen, nur das NÃ¶tigste

â†’ Dynamische Preise, aber keine Optimierung.

â­ ALG 110 â€“ Dynamischer Preis mit Speicher-Optimierung

Das ist schon cleverer.

Hier macht der Algorithmus:

StÃ¼ndliche Preise einlesen

24 Stunden nach vorne schauen

Ãœberlegen: â€Soll ich jetzt laden oder lieber spÃ¤ter, wennâ€™s gÃ¼nstiger ist?â€œ

Wenn die aktuelle Stunde gÃ¼nstig ist â†’ Speicher vollmachen

Wenn die nÃ¤chsten Stunden billiger aussehen â†’ warten

Speicher nutzen, um teure Stunden zu umgehen

â†’ Das ist das erste richtige â€Smart Chargingâ€œ-Verhalten.

â­ ALG 200 â€“ DynPlus: Der komplexe Spezialtarif

Das ist der Modus, in dem viel Speziallogik steckt.

Er macht sehr viele zusÃ¤tzliche Dinge:

âœ” PreisaufschlÃ¤ge berechnen (z. B. staatliche Abgaben)
âœ” Spotpreis korrigieren
âœ” PrÃ¼fen, ob der Kunde oder der Staat verliert
âœ” Berechnen eines â€optimalen Preisesâ€œ
âœ” Logik fÃ¼r negative Preise
âœ” Regeln, wann der Speicher nicht geladen werden darf

Die groÃŸe Idee dahinter:

Kunden sollen bei sehr tiefen Preisen profitieren

aber nicht so stark, dass es fÃ¼r den Tarifanbieter gefÃ¤hrlich wird

deshalb werden AufschlÃ¤ge, Sperrzeiten und Sonderpreise dynamisch berechnet

Kurz gesagt:

â†’ Das ist der â€politisch korrekteâ€œ dynamische Tarif, der versucht, fair und ausgewogen zu sein â€” aber damit sehr kompliziert wird.

â­ ALG 210 â€“ DynPlus + Smart Charging

Dieser Modus kombiniert:

DynPlus-Preisregeln

Smartes Speichermanagement (Lookahead)

Also:

Algorithmus entscheidet jede Stunde:

â€Welcher Preis gilt? (mit AufschlÃ¤gen, Korrekturen, Effekten)â€œ

â€Darf ich den Speicher laden?â€œ

â€Ist eine gÃ¼nstigere Stunde in den nÃ¤chsten 24h zu erwarten?â€œ

â€Entstehen Verluste fÃ¼r Anbieter oder Staat?â€œ

Das ist der komplexeste und â€intelligentesteâ€œ Modus.

â­ ULTRA-Kurzfassung aller Modi
Modus	Idee	Verhalten
10	Fixpreis	Kein Denken, einfach Preis * Verbrauch
100	Dynamisch, aber simpel	Preis Ã¤ndert sich stÃ¼ndlich, aber keine Speicherstrategie
110	Dynamisch + Speicheroptimierung	â€Schlauesâ€œ Laden/Entladen
200	DynPlus	Extra Regeln, AufschlÃ¤ge, optimale Preise
210	DynPlus + Smart Charging	Komplettmodus: volle KomplexitÃ¤t + Speicherintelligenz


======================================================================================


â­ TARIFMODUS 10 â€” Konstanter Strompreis
Was bedeutet dieser Modus?

Der Strom kostet zu jeder Stunde gleich viel.
Es gibt keine dynamischen Preise, keine AufschlÃ¤ge, keinen Lookahead.

Der Speicher wird nur benutzt, wenn der Verbraucher das mÃ¶chte.

ğŸ”¢ Rechenlogik / Formeln
1. Verbrauch pro Stunde
Netzverbrauch = Hausverbrauch â€“ Speicherabgabe

2. Preis pro Stunde
Kosten[h] = Netzverbrauch[h] * KonstanterPreis

3. Speicher

Wenn geladen wird:

SpeicherStand += Ladeleistung * Ladeverlust


Wenn entladen wird:

SpeicherStand -= Entladeleistung / Entladeverlust

4. Gesamtkosten
Gesamtkosten = Summe(Kosten[h] aller Stunden)

â­ TARIFMODUS 100 â€” Reiner dynamischer BÃ¶rsenstrompreis
Was bedeutet dieser Modus?

Jede Stunde hat ihren eigenen Preis.

Es gibt keine Sonderlogik, nur dynamischer Preis * Verbrauch.

Der Speicher wird genutzt, wenn ein Vorteil besteht (gÃ¼nstige Stunde â†’ Laden).

ğŸ”¢ Rechenlogik / Formeln
1. Preis pro Stunde
Kosten[h] = Netzverbrauch[h] * BÃ¶rsenPreis[h]

2. Ladeentscheidung

Der Algorithmus lÃ¤dt nur, wenn die Stunde gÃ¼nstig ist:

Wenn BÃ¶rsenPreis[h] <= BÃ¶rsenPreis[h+Lookahead]:
    Laden
Sonst:
    Warten

3. Speicherberechnung

Wird geladen:

Ladung = Ladeleistung * LadeLetFaktor
SpeicherStand = min(SpeicherStand + Ladung, SpeicherkapazitÃ¤t)


Wird entladen:

Abgabe = min(Hausverbrauch, SpeicherStand)
SpeicherStand -= Abgabe / Entladeverlust
Netzverbrauch = Hausverbrauch - Abgabe

4. Gesamtkosten
Gesamtkosten = Summe(BÃ¶rsenPreis[h] * Netzverbrauch[h])

â­ TARIFMODUS 110 â€” Dynamisch + Speicher wird automatisch nach gÃ¼nstigsten 24h geladen

Dieser Modus nutzt:

dynamische Preise

24-Stunden-Lookahead

automatische Speicherladung in den billigsten Stunden

ğŸ”¢ Rechenlogik / Formeln
Schritt 1 â€“ Lookahead

Der Algorithmus sucht:

BilligsteStunde = min(BÃ¶rsenPreis[h â€¦ h+24])

Schritt 2 â€“ Ladelogik

Wenn die aktuelle Stunde zu den gÃ¼nstigsten gehÃ¶rt:

Wenn BÃ¶rsenPreis[h] <= BilligsteStunde:
    Laden


Sonst:

Nicht laden

Schritt 3 â€“ Kosten

Gleich wie Modus 100:

Kosten[h] = Netzverbrauch[h] * BÃ¶rsenPreis[h]

â­ TARIFMODUS 200+ â€” DynPlus (komplexer Tarif)

Dieser Teil ist der mit Abstand umfangreichste.
Der Code enthÃ¤lt:

Preisaufschlag (â€Bremseâ€œ)

staatlichen Verlust

optimierten Preis

Buchungslogik

Belastung von Speicherladungen

â­ Worum geht es hier?

Der Tarif â€œDynPlusâ€ versucht:

billige Stunden zu â€puffernâ€œ

teure Stunden zu entlasten

einen einheitlichen Durchschnittspreis zu erreichen:

DynPlusPreis = (Summe(Einkaufskosten)) / (Summe(Verbrauch))


Der Speicher wird dabei aktiv genutzt, um den Durchschnitt stabil zu halten.

ğŸ”¢ Rechenlogik / Formeln (vereinfacht)
1. Preisaufschlag prÃ¼fen

Wenn der Preis extrem niedrig oder sogar negativ:

Wenn Preis[h] < -3.5:
    Aufschlag = True
Sonst:
    Aufschlag = False


Wenn Aufschlag aktiv:

Nicht laden

2. Speicherladung mit DynPlus

Wenn Speicher geladen wird:

SpeicherStand += Ladeleistung * Ladeverlust
DynPlusEinkaufsmengen[h] += Ladeleistung
DynPlusEinkaufsWert[h] += Ladeleistung * BÃ¶rsenPreis[h]

3. DynPlus Preisberechnung
DynPlusPreis = Summe(EinkaufsWert) / Summe(Einkaufsmengen)

4. Kostenberechnung

Wenn Verbrauch in teurer Stunde:

Kosten[h] = DynPlusPreis * Netzverbrauch[h]


Wenn Verbrauch in billiger Stunde:

Kosten[h] = BÃ¶rsenPreis[h] * Netzverbrauch[h]

5. Staatlicher Verlust (falls Preisbremse greift)
StaatlicherVerlust[h] = (RealPreis[h] - GebremsterPreis) * Verbrauch[h]



============================================================================================================
Pseudocode
============================================================================================================

FOR jede Stunde ID von 1 bis anzahl:

    // --- Grundinitialisierung ---
    Setze Ladeverbrauch = 0
    Leere Lade- und Speicher-Logtexte
    Setze Verbrauch = 0

    // --- Preisberechnung konstanter Tarif ---
    SummePreisKonstant += PreisKonstant * Leistung


    // === FALL: Algorithmus 10 (OHNE SPEICHER) ===
    IF Alg == 10 THEN
        SummePreisDyn += pb[ID] * Leistung
    END IF


    // === FALL: dynamische Tarife MIT Speicher ===
    IF Alg >= 100 THEN

        // --- Lookahead nach gÃ¼nstigen Preisen ---
        LH = Lookahead Ã¼ber 24 Stunden
        falls LH gÃ¼nstige Stunde findet:
            aktualisiere lhfound

        // --- DynPlus-Preis fÃ¼r diese Stunde berechnen ---
        DynPlusPreis = Funktion GetDynPlusPreis(...)

        // --- Ladeentscheidung ---
        IF aktuelle Stunde == gefundene Lookahead-Stunde AND kein Preisaufschlag aktiv:

            // â†’ Speicher maximal laden
            Ladeverbrauch = Cap - Speicher
            Verbrauch = Ladeverbrauch + Hausverbrauch(Leistung)
            Speicher += Ladeverbrauch
            VerbrauchNetz = Verbrauch

        ELSE
            // --- Normaler Verbrauchsmodus ---
            IF Speicher >= Leistung THEN
                // Speicher deckt den Hausverbrauch komplett
                Verbrauch = Leistung
                Speicher -= Verbrauch
                VerbrauchNetz = 0

            ELSE IF Speicher == 0 THEN
                // Speicher leer â†’ alles aus dem Netz
                Verbrauch = Leistung
                VerbrauchNetz = Verbrauch

            ELSE
                // Teilweise Speicher, Rest Netz
                VerbrauchNetz = Leistung - Speicher
                Speicher = 0
            END IF
        END IF


        // === TARIFMODUS 100 (Standard dynamisch â€“ wie Tibber) ===
        IF Alg == 100 THEN
            SummePreisDyn += pb[ID] * VerbrauchNetz
            falls pb < 0:
                InputDynKunde += negativer Preis * VerbrauchNetz
        END IF


        // === TARIFMODUS 110 (dynamisch mit Speicherverlustberechnung) ===
        IF Alg == 110 THEN
            SummePreisDyn += p0[ID] * VerbrauchNetz
            SummeVerlust += (pb[ID] - p0[ID]) * VerbrauchNetz
            falls p0 < 0:
                InputDynKunde += negativer Nettopreis * VerbrauchNetz
        END IF


        // Log: Speicher leer?
        falls Speicher < 1:
            SpeicherLeerStunden += 1


        // === TARIFMODUS 200+ (DynPlus) ===
        IF Alg >= 200 THEN

            // --- Verwaltung Minimalperiode ---
            IF p0[ID] < 0.03 THEN
                Minimalperiode += 1
            ELSE
                wenn Minimalperiode > 0:
                    MinimalwarAKTIV = TRUE
                    Minimalperiode = 0
            END IF

            // --- automatische Verlust-Korrektur ---
            IF SummeVerlust < -10 THEN
                MinimalwarAKTIV = FALSE
                STDAufschlagOffen += 1
            ELSE
                MinimalwarAKTIV = TRUE
            END IF


            // --- Standardpreis mit mÃ¶glichem Aufschlag ---
            IF p0[ID] <= STDAufschlagBis UND MinimalwarAKTIV == TRUE THEN
                DynPreiSTD = pb[ID] + STDAufschlagWert
                STDAufschlagBENUTZT += 1
            ELSE
                DynPreiSTD = pb[ID]
            END IF


            // --- endgÃ¼ltigen DynPlus-Preis bestimmen ---
            DynPlusPreis = GetDynPlusPreis(...)

            // --- Preis aufsummieren ---
            SummePreisDyn += DynPlusPreis * VerbrauchNetz

            // --- Verlustberechnung Kunde ---
            preisdiff = pb[ID] - DynPlusPreis
            preisdiffSTD = pb[ID] - DynPreiSTD

            SummeVerlustDynPlusKunde += preisdiff * VerbrauchNetz

            // --- Gesamtverlust inkl. "Normalkunden" ---
            SummeVerlust +=
                preisdiff * Leistung
                + preisdiffSTD * Leistung * AnzahlNormalKundenproDynPlusKunde

            // --- Log bei negativem Preis ---
            falls DynPlusPreis < 0:
                InputDynKunde += negativer Preis * VerbrauchNetz

            // --- Logging Netzverbrauch mit/ohne Aufschlag ---
            falls VerbrauchNetz > 0:
                wenn Aufschlag aktiv:
                    Lade-ZÃ¤hler erhÃ¶hen
                sonst:
                    Nichtlade-ZÃ¤hler erhÃ¶hen
        END IF  // Ende DynPlus


        // --- Log: Ladeindikator ---
        falls Ladeverbrauch > 0:
            vermerke Speicherladung

        // --- Verluste in Log schreiben ---
        falls Alg >= 200:
            logge SummeVerlust

        // --- vollstÃ¤ndige Logzeile erzeugen ---
        sinfo = "Datum ... Speicher ... Preise ... Verbrauch usw."

        falls Debug-Level hoch:
            Ausgabe sinfo auf Konsole

    END IF // Ende dynamische Tariflogik


    // ==== LOG-SPEICHERUNG ====
    falls SaveLog:
        Speichere alle relevanten Variablen in der Logdatenbank


    // ==== GUI-/Ausgabe-Updates ====
    falls Counter abgelaufen oder letzte Stunde:
        Schreibe Summenwerte ins GUI


    counter -= 1

NEXT Stunde


